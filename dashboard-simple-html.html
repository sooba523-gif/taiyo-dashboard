<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>たいよう集客戦略ダッシュボード 2025-2026</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #eff6ff, #e0e7ff);
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 24px;
    }
    .header h1 { font-size: 28px; color: #1f2937; margin-bottom: 8px; }
    .header p { color: #6b7280; }
    
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .kpi-card {
      padding: 24px;
      border-radius: 12px;
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .kpi-card.blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .kpi-card.green { background: linear-gradient(135deg, #10b981, #059669); }
    .kpi-card.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .kpi-card.orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .kpi-label { font-size: 14px; opacity: 0.9; margin-bottom: 8px; }
    .kpi-value { font-size: 32px; font-weight: bold; margin-bottom: 4px; }
    .kpi-sub { font-size: 13px; opacity: 0.85; }
    
    .tabs {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 24px;
    }
    .tab-buttons {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      overflow-x: auto;
    }
    .tab-button {
      padding: 16px 24px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #6b7280;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .tab-button:hover { background: #f9fafb; color: #374151; }
    .tab-button.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
      background: #eff6ff;
    }
    .tab-content { padding: 24px; display: none; }
    .tab-content.active { display: block; }
    
    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }
    .chart-card {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
    }
    .chart-card h3 { font-size: 18px; margin-bottom: 8px; color: #1f2937; }
    .chart-card p { font-size: 14px; color: #6b7280; margin-bottom: 16px; }
    
    .alert {
      background: #fff7ed;
      border-left: 4px solid #f59e0b;
      padding: 20px;
      border-radius: 8px;
      margin-top: 24px;
    }
    .alert h4 { color: #92400e; margin-bottom: 12px; font-size: 16px; }
    .alert p { color: #78350f; margin-bottom: 12px; }
    .alert ul { color: #78350f; font-size: 14px; margin-left: 20px; }
    .alert li { margin-bottom: 6px; }
    
    .footer {
      background: white;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      color: #6b7280;
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .channel-list { display: flex; flex-direction: column; gap: 12px; }
    .channel-item {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .channel-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .channel-item.highlight { background: #fff7ed; border-color: #fb923c; }
    .channel-header { display: flex; align-items: center; gap: 12px; }
    .channel-color { width: 16px; height: 16px; border-radius: 50%; flex-shrink: 0; }
    .channel-info { flex: 1; }
    .channel-name { font-weight: 600; color: #1f2937; margin-bottom: 4px; }
    .channel-stats { font-size: 14px; color: #6b7280; }
    
    @media (max-width: 768px) {
      .chart-grid { grid-template-columns: 1fr; }
      .kpi-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>たいよう集客戦略ダッシュボード</h1>
      <p>2025年10月〜2026年9月 | 入居率100%達成計画</p>
    </div>

    <div class="kpi-grid">
      <div class="kpi-card blue">
        <div class="kpi-label">年間目標</div>
        <div class="kpi-value">594名</div>
        <div class="kpi-sub">昨年比: +137名 (+30%)</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">総予算</div>
        <div class="kpi-value">42.2百万円</div>
        <div class="kpi-sub">昨年: 37.2百万円 (+13%)</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">平均CPA</div>
        <div class="kpi-value">7.1万円</div>
        <div class="kpi-sub">昨年: 8.1万円 (-12%改善)</div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">機会損失削減</div>
        <div class="kpi-value">1.2-2億円</div>
        <div class="kpi-sub">空室率: 3-5%削減</div>
      </div>
    </div>

    <div class="tabs">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchTab(0)">全体概要</button>
        <button class="tab-button" onclick="switchTab(1)">チャネル詳細</button>
        <button class="tab-button" onclick="switchTab(2)">四半期計画</button>
        <button class="tab-button" onclick="switchTab(3)">自社メディア</button>
        <button class="tab-button" onclick="switchTab(4)">リスク管理</button>
      </div>

      <!-- Tab 0: 全体概要 -->
      <div class="tab-content active">
        <div class="chart-grid">
          <div class="chart-card">
            <h3>2025-2026年度 目標ポートフォリオ</h3>
            <p>総計: 594名 | 総予算: 42.2百万円 | 平均CPA: 7.1万円</p>
            <canvas id="pieTarget"></canvas>
          </div>
          <div class="chart-card">
            <h3>2024-2025年度 実績ポートフォリオ</h3>
            <p>総計: 457名 | 総予算: 37.2百万円 | 平均CPA: 8.1万円</p>
            <canvas id="pieLastYear"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h3>昨年比較（入居獲得数）</h3>
          <canvas id="barComparison"></canvas>
        </div>
        <div class="alert">
          <h4>🎯 最重要施策</h4>
          <p><strong>自社メディア経由の入居獲得を27名→100名（3.7倍）に増加</strong></p>
          <ul>
            <li>HP改修完了（10月末）- ショート動画・口コミ・検索バー実装済</li>
            <li>AIチャット実装（11月末）</li>
            <li>LINE運用開始（12月14日）</li>
            <li>Instagram運用開始（12月末）</li>
          </ul>
        </div>
      </div>

      <!-- Tab 1: チャネル詳細 -->
      <div class="tab-content">
        <div class="channel-list" id="channelList"></div>
      </div>

      <!-- Tab 2: 四半期計画 -->
      <div class="tab-content">
        <div class="chart-card">
          <h3>四半期別入居獲得目標</h3>
          <canvas id="barQuarterly"></canvas>
        </div>
      </div>

      <!-- Tab 3: 自社メディア -->
      <div class="tab-content">
        <div class="alert" style="background: linear-gradient(135deg, #f59e0b, #d97706); border: none; color: white;">
          <h4 style="color: white;">自社メディア成長計画</h4>
          <p style="color: rgba(255,255,255,0.9);">27名 → 100名（3.7倍成長）</p>
        </div>
        <div class="chart-card" style="margin-top: 24px;">
          <h3>月次推移予測</h3>
          <canvas id="lineOwnMedia"></canvas>
        </div>
      </div>

      <!-- Tab 4: リスク管理 -->
      <div class="tab-content">
        <div class="alert" style="background: #fef2f2; border-left-color: #ef4444;">
          <h4 style="color: #991b1b;">リスクシナリオ：自社メディアが目標の50%</h4>
          <p style="color: #7f1d1d;">
            想定状況: 自社メディア50名（目標比-50名）<br>
            入居率への影響: 96%（最低ライン95%はクリア）<br>
            経営リスク: 低（赤字化の懸念なし）
          </p>
          <h4 style="color: #991b1b; margin-top: 16px;">推奨補完策：CPA効率重視</h4>
          <ul style="color: #7f1d1d;">
            <li>LIFULL介護 +25名（132.5万円、CPA: 5.3万円）</li>
            <li>みんなの介護 +25名（217.5万円、CPA: 8.7万円）</li>
            <li>追加予算合計: 350万円</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="footer">
      最終更新: 2025年10月15日 | データソース: kintone, BigQuery分析結果
    </div>
  </div>

  <script>
    // データ定義
    const channels = [
      { name: 'みんなの介護', target: 153, lastYear: 123, cpa: 8.7, budget: 1331, color: '#3b82f6' },
      { name: 'CM・SW・老健', target: 131, lastYear: 121, cpa: 5.6, budget: 734, color: '#10b981' },
      { name: '自社メディア', target: 100, lastYear: 27, cpa: 5.5, budget: 550, color: '#f59e0b' },
      { name: '紹介会社', target: 88, lastYear: 90, cpa: 17.5, budget: 1540, color: '#ef4444' },
      { name: 'LIFULL介護', target: 46, lastYear: 37, cpa: 5.3, budget: 244, color: '#8b5cf6' },
      { name: '新聞折込', target: 28, lastYear: 21, cpa: 19.8, budget: 554, color: '#ec4899' },
      { name: 'その他', target: 48, lastYear: 38, cpa: 0, budget: 0, color: '#6b7280' }
    ];

    const sortedTarget = [...channels].filter(c => c.name !== 'その他').sort((a,b) => b.target - a.target).concat(channels.filter(c => c.name === 'その他'));
    const sortedLastYear = [...channels].filter(c => c.name !== 'その他').sort((a,b) => b.lastYear - a.lastYear).concat(channels.filter(c => c.name === 'その他'));

    // タブ切り替え
    function switchTab(index) {
      document.querySelectorAll('.tab-button').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.tab-content').forEach((content, i) => {
        content.classList.toggle('active', i === index);
      });
    }

    // 円グラフ（目標）
    new Chart(document.getElementById('pieTarget'), {
      type: 'pie',
      data: {
        labels: sortedTarget.map(c => c.name),
        datasets: [{
          data: sortedTarget.map(c => c.target),
          backgroundColor: sortedTarget.map(c => c.color)
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: (context) => {
                const label = context.label || '';
                const value = context.parsed || 0;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percent = ((value / total) * 100).toFixed(1);
                return `${label}: ${value}名 (${percent}%)`;
              }
            }
          }
        }
      }
    });

    // 円グラフ（実績）
    new Chart(document.getElementById('pieLastYear'), {
      type: 'pie',
      data: {
        labels: sortedLastYear.map(c => c.name),
        datasets: [{
          data: sortedLastYear.map(c => c.lastYear),
          backgroundColor: sortedLastYear.map(c => c.color)
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: (context) => {
                const label = context.label || '';
                const value = context.parsed || 0;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percent = ((value / total) * 100).toFixed(1);
                return `${label}: ${value}名 (${percent}%)`;
              }
            }
          }
        }
      }
    });

    // 棒グラフ（比較）
    new Chart(document.getElementById('barComparison'), {
      type: 'bar',
      data: {
        labels: channels.map(c => c.name),
        datasets: [
          {
            label: '昨年',
            data: channels.map(c => c.lastYear),
            backgroundColor: '#94a3b8'
          },
          {
            label: '目標',
            data: channels.map(c => c.target),
            backgroundColor: '#3b82f6'
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // 棒グラフ（四半期）
    new Chart(document.getElementById('barQuarterly'), {
      type: 'bar',
      data: {
        labels: ['Q1 (10-12月)', 'Q2 (1-3月)', 'Q3 (4-6月)', 'Q4 (7-9月)'],
        datasets: [
          { label: '自社メディア', data: [15, 21, 27, 37], backgroundColor: '#f59e0b' },
          { label: 'みんなの介護', data: [36, 38, 39, 40], backgroundColor: '#3b82f6' },
          { label: 'CM・SW', data: [31, 33, 33, 34], backgroundColor: '#10b981' },
          { label: '紹介会社', data: [22, 22, 22, 22], backgroundColor: '#ef4444' },
          { label: 'LIFULL', data: [11, 11, 12, 12], backgroundColor: '#8b5cf6' },
          { label: '新聞', data: [7, 7, 7, 7], backgroundColor: '#ec4899' },
          { label: 'その他', data: [12, 12, 12, 12], backgroundColor: '#6b7280' }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: { stacked: true },
          y: { stacked: true, beginAtZero: true }
        }
      }
    });

    // 折れ線グラフ（自社メディア）
    new Chart(document.getElementById('lineOwnMedia'), {
      type: 'line',
      data: {
        labels: ['現在', '12月', '3月', '6月', '9月'],
        datasets: [
          {
            label: '問い合わせ数',
            data: [11.7, 18, 24, 30, 36],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4
          },
          {
            label: '入居獲得数',
            data: [2.7, 5, 7, 9, 12],
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            tension: 0.4
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // チャネルリスト作成
    const channelListEl = document.getElementById('channelList');
    channels.forEach(ch => {
      const item = document.createElement('div');
      item.className = 'channel-item' + (ch.name === '自社メディア' ? ' highlight' : '');
      item.innerHTML = `
        <div class="channel-header">
          <div class="channel-color" style="background-color: ${ch.color}"></div>
          <div class="channel-info">
            <div class="channel-name">${ch.name}</div>
            <div class="channel-stats">
              目標: ${ch.target}名 | CPA: ${ch.cpa}万円 | 予算: ${ch.budget}万円 | 昨年: ${ch.lastYear}名 (${ch.target > ch.lastYear ? '+' : ''}${((ch.target / ch.lastYear - 1) * 100).toFixed(0)}%)
            </div>
          </div>
        </div>
      `;
      channelListEl.appendChild(item);
    });
  </script>
</body>
</html>